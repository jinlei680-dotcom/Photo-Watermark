# 照片水印工具 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 项目背景
随着数字摄影的普及，用户经常需要在照片上添加时间水印来记录拍摄时间，特别是在整理大量照片时。现有的图片处理软件往往功能复杂，对于简单的时间水印需求来说过于繁重。因此，我们需要开发一个专门的Java命令行工具，能够自动读取照片的EXIF信息并添加时间水印。

### 1.2 项目目标
开发一个轻量级的Java命令行程序，能够批量为照片添加基于EXIF拍摄时间的水印，提供灵活的水印样式配置选项。

### 1.3 目标用户
- 摄影爱好者
- 需要批量处理照片的用户
- 希望为照片添加时间标记的个人用户
- 需要简单图片处理工具的开发者

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 图片路径输入
- **功能描述**: 用户通过命令行参数或交互式输入指定图片文件夹路径
- **输入格式**: 支持绝对路径和相对路径
- **验证要求**: 
  - 验证路径是否存在
  - 验证路径是否为有效目录
  - 提供友好的错误提示

#### 2.1.2 EXIF信息读取
- **功能描述**: 读取指定目录下所有图片文件的EXIF信息
- **支持格式**: JPEG, TIFF, RAW等包含EXIF信息的格式
- **提取信息**: 
  - 拍摄时间 (DateTimeOriginal)
  - 格式化为年月日 (YYYY-MM-DD)
- **异常处理**: 
  - 无EXIF信息的文件跳过并记录
  - 损坏文件的处理

#### 2.1.3 水印配置
- **字体大小**: 用户可设置字体大小 (默认: 24px)
- **字体颜色**: 支持常见颜色名称和RGB值 (默认: 白色)
- **水印位置**: 
  - 左上角 (TOP_LEFT)
  - 居中 (CENTER)
  - 右下角 (BOTTOM_RIGHT)
  - 左下角 (BOTTOM_LEFT)
  - 右上角 (TOP_RIGHT)
- **透明度**: 支持设置水印透明度 (0-100%)

#### 2.1.4 图片处理与保存
- **水印绘制**: 在原图上绘制时间水印
- **输出目录**: 在原目录下创建 `原目录名_watermark` 子目录
- **文件命名**: 保持原文件名不变
- **格式保持**: 输出格式与原图格式一致
- **质量控制**: 保持高质量输出，避免过度压缩

### 2.2 辅助功能

#### 2.2.1 批量处理
- 支持处理目录下所有支持的图片格式
- 显示处理进度
- 统计处理结果

#### 2.2.2 配置管理
- 支持配置文件保存常用设置
- 命令行参数覆盖配置文件设置

#### 2.2.3 日志记录
- 记录处理过程和结果
- 错误日志记录
- 可选的详细模式

## 3. 技术需求

### 3.1 开发环境
- **编程语言**: Java 8+
- **构建工具**: Maven
- **IDE**: 任意支持Java的IDE

### 3.2 依赖库
- **图片处理**: Java BufferedImage + Graphics2D
- **EXIF读取**: metadata-extractor 库
- **命令行解析**: Apache Commons CLI
- **日志框架**: SLF4J + Logback

### 3.3 性能要求
- 单张图片处理时间 < 2秒
- 内存使用控制在合理范围内
- 支持大批量图片处理

### 3.4 兼容性要求
- 跨平台支持 (Windows, macOS, Linux)
- Java 8+ 兼容性

## 4. 用户故事

### 4.1 基础使用场景
**作为一个摄影爱好者**，我希望能够快速为我的照片添加拍摄日期水印，这样我就能够在查看照片时快速了解拍摄时间。

**验收标准**:
- 能够指定包含照片的文件夹
- 程序自动读取每张照片的拍摄时间
- 在照片上添加格式化的日期水印
- 保存处理后的照片到新目录

### 4.2 自定义水印样式
**作为一个用户**，我希望能够自定义水印的外观，包括字体大小、颜色和位置，以适应不同照片的需求。

**验收标准**:
- 可以设置水印字体大小
- 可以选择水印颜色
- 可以选择水印在照片上的位置
- 设置能够正确应用到所有处理的照片

### 4.3 批量处理
**作为一个需要处理大量照片的用户**，我希望程序能够批量处理整个文件夹的照片，并显示处理进度。

**验收标准**:
- 能够处理文件夹中的所有支持格式的图片
- 显示处理进度和状态
- 提供处理结果统计
- 错误处理不影响其他文件的处理

## 5. 技术规格

### 5.1 命令行接口
```bash
java -jar photo-watermark.jar [OPTIONS] <input-directory>

选项:
  -s, --size <size>        字体大小 (默认: 24)
  -c, --color <color>      字体颜色 (默认: white)
  -p, --position <pos>     水印位置 (默认: bottom-right)
  -a, --alpha <alpha>      透明度 0-100 (默认: 80)
  -v, --verbose           详细输出模式
  -h, --help              显示帮助信息
```

### 5.2 配置文件格式 (config.properties)
```properties
# 默认水印设置
watermark.font.size=24
watermark.font.color=white
watermark.position=bottom-right
watermark.alpha=80

# 支持的图片格式
supported.formats=jpg,jpeg,tiff,tif

# 输出设置
output.quality=0.95
```

### 5.3 目录结构
```
input-directory/
├── photo1.jpg
├── photo2.jpg
└── input-directory_watermark/
    ├── photo1.jpg
    └── photo2.jpg
```

## 6. 验收标准

### 6.1 功能验收
- [ ] 能够正确读取指定目录下的所有图片文件
- [ ] 能够提取EXIF中的拍摄时间信息
- [ ] 能够根据用户设置绘制水印
- [ ] 能够保存处理后的图片到指定目录
- [ ] 支持所有规定的水印位置选项
- [ ] 支持字体大小和颜色自定义

### 6.2 性能验收
- [ ] 单张图片处理时间不超过2秒
- [ ] 能够处理至少1000张图片的批量任务
- [ ] 内存使用合理，无内存泄漏

### 6.3 用户体验验收
- [ ] 命令行界面友好，错误提示清晰
- [ ] 处理进度可视化
- [ ] 支持帮助文档和使用说明

### 6.4 质量验收
- [ ] 代码覆盖率 > 80%
- [ ] 无严重bug
- [ ] 跨平台兼容性测试通过

## 7. 项目里程碑

### 阶段1: 核心功能开发 (1-2周)
- EXIF信息读取功能
- 基础水印绘制功能
- 文件输入输出处理

### 阶段2: 功能完善 (1周)
- 命令行参数解析
- 配置文件支持
- 错误处理和日志

### 阶段3: 测试和优化 (1周)
- 单元测试编写
- 性能优化
- 跨平台测试

### 阶段4: 文档和发布 (0.5周)
- 用户文档编写
- 打包和发布准备

## 8. 风险评估

### 8.1 技术风险
- **EXIF信息缺失**: 部分图片可能没有EXIF信息
- **内存使用**: 大图片处理可能消耗大量内存
- **格式兼容性**: 不同图片格式的处理差异

### 8.2 缓解措施
- 实现robust的错误处理机制
- 采用流式处理减少内存占用
- 充分测试各种图片格式

## 9. 成功指标

- 用户能够在5分钟内学会使用该工具
- 批量处理100张照片的时间不超过5分钟
- 用户满意度评分 > 4.0/5.0
- 零严重bug发布